<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>大学报考</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link href="/Content/frozenui.css" rel="stylesheet" />
    <link href="/Content/common.css" rel="stylesheet" />

    <script src="/Scripts/Libraries/jquery-1.12.4.min.js"></script>
    <script src="/Scripts/Framework/Components/base.js"></script>
    <script src="/Scripts/Framework/util.js"></script>
    <script src="/Scripts/Framework/Components/icon_return.js"></script>
    <script src="/Scripts/Framework/Components/div_list_info.js"></script>
    <script src="/Scripts/university.js"></script>
    <script src="/Scripts/scholarship.js"></script>
</head>
<body>
    <header></header>
    <footer></footer>
    <section class="ui-container">
        <ul class="ui-list" id="scholarships">
        </ul>
    </section>

    <script>
        var _university;
        var _scholarShips;
        $(document).ready(function () {
            pageInit();
        });

        function pageInit() {
            initUniversity();
            initScholarShips();

            _university.load();
            _scholarShips.load();
        }

        function initPageList() {
            var _scholarShipUI = new scholarShipUI();
            $("#scholarships").pageList({
                itemTemplate: _scholarShipUI.listItemUI,
                events: {
                    detail: function (e) {
                        var target = e.target;
                        var scholarShipId = $(target).data("scholarShip")["scholarShipId"];
                        window.location.href = "/home/province/city/university/scholarship/detail.html?scholarShipId=" + scholarShipId;
                    },
                    del: function (obj) {
                        var target = e.target;
                        var _scholarship = $(target).data("scholarShip");
                        var removeElem = $(target).data("removeElem");
                        _scholarship.afterDelete = function () {
                            $(removeElem).remove();
                            _scholarShips.filter.startNumber = _scholarShips.filter.startNumber - 1;
                        }
                        _scholarship.delete();
                    }
                }
            });
        }

        function initUniversity() {
            _university = new university();
            _university.universityId = getUniversityId();
            _university.afterLoad = function () {
                var _self = this;
                $("header").pageHeader({
                    canReturn: true,
                    headerName: _self.universityName + " 奖学金列表",
                    action: function () {
                        window.location.href = "/home/province/city/university/scholarship/detail.html?universityId=" + getUniversityId();
                    }
                });
                $("footer").pageFooter({
                    controls: {
                        btnPrev: {
                            text: "前一页",
                            type: "button",
                            click: function () {
                                if (_scholarShips.isFirst()) return;
                                _scholarShips.prePage();
                                _scholarShips.load();
                            }
                        },
                        btnNext: {
                            text: "下一页",
                            type: "button",
                            click: function () {
                                if (_scholarShips.isLast()) return;
                                _scholarShips.nextPage();
                                _scholarShips.load();
                            }
                        }
                    }
                })
            }
        }

        function initScholarShips() {
            _scholarShips = new scholarShips();
            _scholarShips.filter.universityId = getUniversityId();
            _scholarShips.filter.pageIndex = 1;
            _scholarShips.filter.pageSize = 50;
            _scholarShips.afterLoad = function () {
                var _self = this;
                document.getElementById("scholarships").innerHTML = "";
                document.getElementById("scholarships").appendChild(_self.listUI());
            }
        }

        function getUniversityId() {
            var universityId = $.getQueryString("universityId");
            if (universityId == null) {
                return 0;
            } else {
                return parseInt(universityId);
            }
        }
    </script>
</body>
</html>
